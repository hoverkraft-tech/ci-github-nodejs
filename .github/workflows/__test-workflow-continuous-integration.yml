name: Internal - Test Continuous integration workflow

on:
  workflow_call:

permissions:
  contents: read
  security-events: write
  # FIXME: This is a workaround for having workflow ref. See https://github.com/orgs/community/discussions/38659
  id-token: write

jobs:
  act:
    name: Act - Run the continuous integration workflow
    uses: ./.github/workflows/continuous-integration.yml
    with:
      build: |
        {
          "artifact": "dist"
        }

  assert:
    name: Assert - Ensure build artifact has been uploaded
    runs-on: ubuntu-latest
    needs: act
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - uses: actions/download-artifact@634f93cb2916e3fdff6788551b99b062d0335ce0 # v5.0.0
        with:
          name: build
          path: "/"

      - name: Check the build artifacts
        run: test -f dist/test.txt
